{"version":3,"file":"points.js","sources":["pages/user/points.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdXNlci9wb2ludHMudnVl"],"sourcesContent":["<template>\r\n  <view class=\"points-container\">\r\n    <!-- 积分头部 -->\r\n    <view class=\"points-header\">\r\n      <view class=\"header-content\">\r\n        <view class=\"points-title\">我的积分</view>\r\n        <view class=\"points-value\">{{ userInfo.points || 0 }}</view>\r\n        <view class=\"points-desc\">可用于兑换商品和服务</view>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 积分操作区 -->\r\n    <view class=\"action-card\">\r\n      <view\r\n        class=\"action-item\"\r\n        @click=\"navigateTo('/pages/user/points-history')\"\r\n      >\r\n        <image\r\n          src=\"https://cdn-icons-png.flaticon.com/128/2961/2961543.png\"\r\n          class=\"action-icon\"\r\n        ></image>\r\n        <text class=\"action-text\">积分明细</text>\r\n      </view>\r\n      <view\r\n        class=\"action-item\"\r\n        @click=\"navigateTo('/pages/user/points-exchange')\"\r\n      >\r\n        <image\r\n          src=\"https://cdn-icons-png.flaticon.com/128/1611/1611179.png\"\r\n          class=\"action-icon\"\r\n        ></image>\r\n        <text class=\"action-text\">积分兑换</text>\r\n      </view>\r\n      <view class=\"action-item\" @click=\"navigateTo('/pages/user/points-task')\">\r\n        <image\r\n          src=\"https://cdn-icons-png.flaticon.com/128/3208/3208615.png\"\r\n          class=\"action-icon\"\r\n        ></image>\r\n        <text class=\"action-text\">赚取积分</text>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 积分规则说明 -->\r\n    <view class=\"rule-card\">\r\n      <view class=\"card-header\">\r\n        <text class=\"card-title\">积分规则</text>\r\n      </view>\r\n      <view class=\"rule-content\">\r\n        <view class=\"rule-item\">\r\n          <text class=\"rule-title\">如何获取积分？</text>\r\n          <view class=\"rule-detail\">\r\n            <text>• 首次注册：+100积分</text>\r\n            <text>• 每日签到：+10积分</text>\r\n            <text>• 完成订单：订单金额的1%转换为积分</text>\r\n            <text>• 评价订单：+5积分/次</text>\r\n            <text>• 分享商品：+2积分/次（每日上限10次）</text>\r\n          </view>\r\n        </view>\r\n        <view class=\"rule-item\">\r\n          <text class=\"rule-title\">积分使用说明</text>\r\n          <view class=\"rule-detail\">\r\n            <text>• 100积分 = ¥1元</text>\r\n            <text>• 积分可用于商品抵扣</text>\r\n            <text>• 积分可兑换优惠券</text>\r\n            <text>• 积分有效期为一年</text>\r\n          </view>\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 积分任务 -->\r\n    <view class=\"task-card\">\r\n      <view class=\"card-header\">\r\n        <text class=\"card-title\">今日任务</text>\r\n        <text class=\"header-desc\">完成任务获取积分</text>\r\n      </view>\r\n      <view class=\"task-list\">\r\n        <view class=\"task-item\" v-for=\"(item, index) in taskList\" :key=\"index\">\r\n          <view class=\"task-info\">\r\n            <image :src=\"item.icon\" class=\"task-icon\"></image>\r\n            <view class=\"task-detail\">\r\n              <text class=\"task-name\">{{ item.name }}</text>\r\n              <text class=\"task-desc\">{{ item.desc }}</text>\r\n            </view>\r\n          </view>\r\n          <view\r\n            :class=\"['task-btn', item.completed ? 'completed' : '']\"\r\n            @click=\"completeTask(index)\"\r\n          >\r\n            {{ item.completed ? \"已完成\" : \"+\" + item.points }}\r\n          </view>\r\n        </view>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      userInfo: {\r\n        points: 0,\r\n      },\r\n      taskList: [\r\n        {\r\n          icon: \"https://cdn-icons-png.flaticon.com/128/2997/2997933.png\",\r\n          name: \"每日签到\",\r\n          desc: \"完成每日签到任务\",\r\n          points: 10,\r\n          completed: false,\r\n        },\r\n        {\r\n          icon: \"https://cdn-icons-png.flaticon.com/128/1968/1968666.png\",\r\n          name: \"浏览商品\",\r\n          desc: \"浏览5个商品详情\",\r\n          points: 5,\r\n          completed: false,\r\n        },\r\n        {\r\n          icon: \"https://cdn-icons-png.flaticon.com/128/3898/3898082.png\",\r\n          name: \"分享商品\",\r\n          desc: \"分享商品给好友\",\r\n          points: 2,\r\n          completed: false,\r\n        },\r\n        {\r\n          icon: \"https://cdn-icons-png.flaticon.com/128/2361/2361728.png\",\r\n          name: \"评价订单\",\r\n          desc: \"评价已完成的订单\",\r\n          points: 5,\r\n          completed: false,\r\n        },\r\n        {\r\n          icon: \"https://cdn-icons-png.flaticon.com/128/9464/9464086.png\",\r\n          name: \"完善资料\",\r\n          desc: \"完善个人资料\",\r\n          points: 20,\r\n          completed: true,\r\n        },\r\n      ],\r\n    };\r\n  },\r\n  onLoad() {\r\n    // 从本地缓存获取用户信息\r\n    const userInfoStr = uni.getStorageSync(\"userInfo\");\r\n    if (userInfoStr) {\r\n      this.userInfo = JSON.parse(userInfoStr);\r\n    }\r\n\r\n    // 加载任务完成状态\r\n    this.loadTaskStatus();\r\n  },\r\n  methods: {\r\n    // 导航到指定页面\r\n    navigateTo(url) {\r\n      // 检查页面是否开发完成\r\n      if (\r\n        url.includes(\"points-history\") ||\r\n        url.includes(\"points-exchange\") ||\r\n        url.includes(\"points-task\")\r\n      ) {\r\n        uni.showToast({\r\n          title: \"功能开发中...\",\r\n          icon: \"none\",\r\n        });\r\n        return;\r\n      }\r\n\r\n      uni.navigateTo({\r\n        url: url,\r\n      });\r\n    },\r\n\r\n    // 加载任务状态\r\n    loadTaskStatus() {\r\n      // 从缓存中获取任务状态\r\n      const taskStatus = uni.getStorageSync(\"pointsTaskStatus\");\r\n      if (taskStatus) {\r\n        const taskData = JSON.parse(taskStatus);\r\n        // 检查是否是今天的数据\r\n        const today = new Date().toDateString();\r\n        if (taskData.date === today) {\r\n          // 更新任务状态\r\n          this.taskList.forEach((task, index) => {\r\n            if (taskData.completed && taskData.completed.includes(index)) {\r\n              this.taskList[index].completed = true;\r\n            }\r\n          });\r\n        } else {\r\n          // 新的一天，重置任务状态（保留永久完成的任务）\r\n          this.taskList[4].completed = true; // 假设\"完善资料\"是永久完成的\r\n          this.saveTaskStatus();\r\n        }\r\n      }\r\n    },\r\n\r\n    // 保存任务状态\r\n    saveTaskStatus() {\r\n      const completed = this.taskList\r\n        .map((task, index) => (task.completed ? index : -1))\r\n        .filter((index) => index !== -1);\r\n\r\n      const taskStatus = {\r\n        date: new Date().toDateString(),\r\n        completed: completed,\r\n      };\r\n\r\n      uni.setStorageSync(\"pointsTaskStatus\", JSON.stringify(taskStatus));\r\n    },\r\n\r\n    // 完成任务\r\n    completeTask(index) {\r\n      // 已完成的任务不能再次点击\r\n      if (this.taskList[index].completed) {\r\n        return;\r\n      }\r\n\r\n      // 根据任务类型执行不同操作\r\n      switch (index) {\r\n        case 0: // 每日签到\r\n          this.signIn();\r\n          break;\r\n        case 1: // 浏览商品\r\n        case 2: // 分享商品\r\n        case 3: // 评价订单\r\n          uni.showToast({\r\n            title: \"请在对应页面完成任务\",\r\n            icon: \"none\",\r\n          });\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    },\r\n\r\n    // 签到功能\r\n    signIn() {\r\n      uni.showLoading({\r\n        title: \"签到中...\",\r\n      });\r\n\r\n      // 模拟网络请求\r\n      setTimeout(() => {\r\n        // 更新积分\r\n        const points = this.userInfo.points || 0;\r\n        this.userInfo.points = points + 10;\r\n\r\n        // 更新本地存储\r\n        uni.setStorageSync(\"userInfo\", JSON.stringify(this.userInfo));\r\n\r\n        // 更新任务状态\r\n        this.taskList[0].completed = true;\r\n        this.saveTaskStatus();\r\n\r\n        uni.hideLoading();\r\n        uni.showToast({\r\n          title: \"签到成功 +10积分\",\r\n          icon: \"success\",\r\n        });\r\n\r\n        // 实际项目中应该调用云函数更新用户积分\r\n        if (this.userInfo._id) {\r\n          const db = wx.cloud.database();\r\n          db.collection(\"userinfo\")\r\n            .doc(this.userInfo._id)\r\n            .update({\r\n              data: {\r\n                points: this.userInfo.points,\r\n              },\r\n            })\r\n            .then(() => {\r\n              console.log(\"积分更新成功\");\r\n            })\r\n            .catch((err) => {\r\n              console.error(\"积分更新失败\", err);\r\n            });\r\n        }\r\n      }, 1000);\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style>\r\n.points-container {\r\n  min-height: 100vh;\r\n  background-color: #f7f7f7;\r\n  padding-bottom: 30rpx;\r\n}\r\n\r\n.points-header {\r\n  height: 300rpx;\r\n  background: linear-gradient(to right, #1296db, #14b8e4);\r\n  color: #fff;\r\n  position: relative;\r\n  overflow: hidden;\r\n  padding: 40rpx 30rpx;\r\n  box-sizing: border-box;\r\n}\r\n\r\n.header-content {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n  height: 100%;\r\n}\r\n\r\n.points-title {\r\n  font-size: 32rpx;\r\n  margin-bottom: 20rpx;\r\n}\r\n\r\n.points-value {\r\n  font-size: 80rpx;\r\n  font-weight: bold;\r\n  margin-bottom: 10rpx;\r\n}\r\n\r\n.points-desc {\r\n  font-size: 24rpx;\r\n  opacity: 0.8;\r\n}\r\n\r\n.action-card {\r\n  margin: -50rpx 30rpx 30rpx;\r\n  background-color: #fff;\r\n  border-radius: 12rpx;\r\n  display: flex;\r\n  justify-content: space-around;\r\n  padding: 30rpx 0;\r\n  position: relative;\r\n  z-index: 3;\r\n  box-shadow: 0 4rpx 20rpx rgba(0, 0, 0, 0.08);\r\n}\r\n\r\n.action-item {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n}\r\n\r\n.action-icon {\r\n  width: 60rpx;\r\n  height: 60rpx;\r\n  margin-bottom: 15rpx;\r\n}\r\n\r\n.action-text {\r\n  font-size: 28rpx;\r\n  color: #333;\r\n}\r\n\r\n.rule-card,\r\n.task-card {\r\n  margin: 30rpx;\r\n  background-color: #fff;\r\n  border-radius: 12rpx;\r\n  padding: 30rpx;\r\n  box-shadow: 0 2rpx 10rpx rgba(0, 0, 0, 0.05);\r\n}\r\n\r\n.card-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 20rpx;\r\n}\r\n\r\n.card-title {\r\n  font-size: 32rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n  position: relative;\r\n  padding-left: 20rpx;\r\n}\r\n\r\n.card-title::before {\r\n  content: \"\";\r\n  position: absolute;\r\n  left: 0;\r\n  top: 50%;\r\n  transform: translateY(-50%);\r\n  width: 6rpx;\r\n  height: 30rpx;\r\n  background-color: #1296db;\r\n  border-radius: 3rpx;\r\n}\r\n\r\n.header-desc {\r\n  font-size: 24rpx;\r\n  color: #999;\r\n}\r\n\r\n.rule-item {\r\n  margin-bottom: 30rpx;\r\n}\r\n\r\n.rule-item:last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n.rule-title {\r\n  font-size: 28rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n  margin-bottom: 15rpx;\r\n  display: block;\r\n}\r\n\r\n.rule-detail {\r\n  font-size: 26rpx;\r\n  color: #666;\r\n  line-height: 1.6;\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.task-list {\r\n  padding: 10rpx 0;\r\n}\r\n\r\n.task-item {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding: 20rpx 0;\r\n  border-bottom: 1px solid #f5f5f5;\r\n}\r\n\r\n.task-item:last-child {\r\n  border-bottom: none;\r\n}\r\n\r\n.task-info {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.task-icon {\r\n  width: 60rpx;\r\n  height: 60rpx;\r\n  margin-right: 20rpx;\r\n}\r\n\r\n.task-detail {\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.task-name {\r\n  font-size: 28rpx;\r\n  color: #333;\r\n  margin-bottom: 6rpx;\r\n}\r\n\r\n.task-desc {\r\n  font-size: 24rpx;\r\n  color: #999;\r\n}\r\n\r\n.task-btn {\r\n  width: 120rpx;\r\n  height: 60rpx;\r\n  background-color: #1296db;\r\n  color: #fff;\r\n  font-size: 28rpx;\r\n  border-radius: 30rpx;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.task-btn.completed {\r\n  background-color: #ddd;\r\n}\r\n</style>\r\n","import MiniProgramPage from 'C:/Users/Administrator/Desktop/wx-pos/pages/user/points.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","wx"],"mappings":"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"}