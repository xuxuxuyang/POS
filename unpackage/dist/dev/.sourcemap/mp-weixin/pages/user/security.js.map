{"version":3,"file":"security.js","sources":["pages/user/security.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdXNlci9zZWN1cml0eS52dWU"],"sourcesContent":["<template>\r\n  <view class=\"security-container\">\r\n    <view class=\"security-header\">\r\n      <text class=\"header-title\">账户安全</text>\r\n      <text class=\"header-desc\"\r\n        >保障您的账户安全，请定期更新密码与验证信息</text\r\n      >\r\n    </view>\r\n\r\n    <view class=\"security-list\">\r\n      <!-- 手机号绑定 -->\r\n      <view class=\"security-item\" @click=\"handlePhoneVerify\">\r\n        <view class=\"item-left\">\r\n          <image\r\n            src=\"https://cdn-icons-png.flaticon.com/128/15/15874.png\"\r\n            class=\"item-icon\"\r\n          ></image>\r\n          <view class=\"item-info\">\r\n            <text class=\"item-title\">手机号绑定</text>\r\n            <text class=\"item-value\">{{\r\n              userInfo.phone\r\n                ? userInfo.phone.replace(/(\\d{3})\\d{4}(\\d{4})/, \"$1****$2\")\r\n                : \"未绑定\"\r\n            }}</text>\r\n          </view>\r\n        </view>\r\n        <image\r\n          src=\"https://cdn-icons-png.flaticon.com/128/271/271228.png\"\r\n          class=\"arrow-icon\"\r\n        ></image>\r\n      </view>\r\n\r\n      <!-- 设置支付密码 -->\r\n      <view class=\"security-item\" @click=\"handleSetPayPassword\">\r\n        <view class=\"item-left\">\r\n          <image\r\n            src=\"https://cdn-icons-png.flaticon.com/128/2889/2889676.png\"\r\n            class=\"item-icon\"\r\n          ></image>\r\n          <view class=\"item-info\">\r\n            <text class=\"item-title\">支付密码</text>\r\n            <text class=\"item-value\">{{\r\n              hasPayPassword ? \"已设置\" : \"未设置\"\r\n            }}</text>\r\n          </view>\r\n        </view>\r\n        <image\r\n          src=\"https://cdn-icons-png.flaticon.com/128/271/271228.png\"\r\n          class=\"arrow-icon\"\r\n        ></image>\r\n      </view>\r\n\r\n      <!-- 微信授权信息 -->\r\n      <view class=\"security-item\" @click=\"handleWechatAuth\">\r\n        <view class=\"item-left\">\r\n          <image\r\n            src=\"https://cdn-icons-png.flaticon.com/128/889/889101.png\"\r\n            class=\"item-icon\"\r\n          ></image>\r\n          <view class=\"item-info\">\r\n            <text class=\"item-title\">微信授权</text>\r\n            <text class=\"item-value\">已绑定</text>\r\n          </view>\r\n        </view>\r\n        <image\r\n          src=\"https://cdn-icons-png.flaticon.com/128/271/271228.png\"\r\n          class=\"arrow-icon\"\r\n        ></image>\r\n      </view>\r\n\r\n      <!-- 实名认证 -->\r\n      <view class=\"security-item\" @click=\"handleVerifyIdentity\">\r\n        <view class=\"item-left\">\r\n          <image\r\n            src=\"https://cdn-icons-png.flaticon.com/128/1484/1484799.png\"\r\n            class=\"item-icon\"\r\n          ></image>\r\n          <view class=\"item-info\">\r\n            <text class=\"item-title\">实名认证</text>\r\n            <text class=\"item-value\">{{\r\n              userInfo.isVerified ? \"已认证\" : \"未认证\"\r\n            }}</text>\r\n          </view>\r\n        </view>\r\n        <image\r\n          src=\"https://cdn-icons-png.flaticon.com/128/271/271228.png\"\r\n          class=\"arrow-icon\"\r\n        ></image>\r\n      </view>\r\n\r\n      <!-- 登录密码 -->\r\n      <view class=\"security-item\" @click=\"handleChangeLoginPassword\">\r\n        <view class=\"item-left\">\r\n          <image\r\n            src=\"https://cdn-icons-png.flaticon.com/128/807/807292.png\"\r\n            class=\"item-icon\"\r\n          ></image>\r\n          <view class=\"item-info\">\r\n            <text class=\"item-title\">修改登录密码</text>\r\n            <text class=\"item-value\">定期修改更安全</text>\r\n          </view>\r\n        </view>\r\n        <image\r\n          src=\"https://cdn-icons-png.flaticon.com/128/271/271228.png\"\r\n          class=\"arrow-icon\"\r\n        ></image>\r\n      </view>\r\n    </view>\r\n\r\n    <view class=\"tips-card\">\r\n      <view class=\"tips-header\">\r\n        <image\r\n          src=\"https://cdn-icons-png.flaticon.com/128/1041/1041728.png\"\r\n          class=\"tips-icon\"\r\n        ></image>\r\n        <text class=\"tips-title\">安全提示</text>\r\n      </view>\r\n      <view class=\"tips-content\">\r\n        <view class=\"tip-item\">\r\n          <text class=\"tip-dot\">•</text>\r\n          <text class=\"tip-text\">定期更改密码，不要使用简单密码</text>\r\n        </view>\r\n        <view class=\"tip-item\">\r\n          <text class=\"tip-dot\">•</text>\r\n          <text class=\"tip-text\">请勿将账号信息透露给他人</text>\r\n        </view>\r\n        <view class=\"tip-item\">\r\n          <text class=\"tip-dot\">•</text>\r\n          <text class=\"tip-text\">如发现异常登录，请立即修改密码</text>\r\n        </view>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      userInfo: {\r\n        phone: \"\",\r\n        isVerified: false,\r\n      },\r\n      hasPayPassword: false,\r\n    };\r\n  },\r\n  onLoad() {\r\n    this.checkLoginStatus();\r\n  },\r\n  onShow() {\r\n    this.getUserInfo();\r\n  },\r\n  methods: {\r\n    // 检查登录状态\r\n    checkLoginStatus() {\r\n      const userInfo = uni.getStorageSync(\"userInfo\");\r\n      if (!userInfo) {\r\n        uni.showToast({\r\n          title: \"请先登录\",\r\n          icon: \"none\",\r\n          success: () => {\r\n            setTimeout(() => {\r\n              uni.navigateBack();\r\n            }, 1500);\r\n          },\r\n        });\r\n      }\r\n    },\r\n\r\n    // 获取用户信息\r\n    getUserInfo() {\r\n      const userInfoStr = uni.getStorageSync(\"userInfo\");\r\n      if (userInfoStr) {\r\n        try {\r\n          const userInfo = JSON.parse(userInfoStr);\r\n          this.userInfo = userInfo;\r\n\r\n          // 如果有用户ID，从数据库获取更多信息\r\n          if (userInfo._id) {\r\n            this.fetchUserSecurityInfo(userInfo._id);\r\n          }\r\n        } catch (e) {\r\n          console.error(\"解析用户信息失败\", e);\r\n        }\r\n      }\r\n    },\r\n\r\n    // 获取用户安全信息\r\n    fetchUserSecurityInfo(userId) {\r\n      const db = wx.cloud.database();\r\n      db.collection(\"userinfo\")\r\n        .doc(userId)\r\n        .get()\r\n        .then((res) => {\r\n          if (res.data) {\r\n            // 更新用户信息\r\n            this.userInfo = res.data;\r\n\r\n            // 检查是否设置了支付密码\r\n            this.hasPayPassword = !!res.data.hasPayPassword;\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          console.error(\"获取用户安全信息失败\", err);\r\n        });\r\n    },\r\n\r\n    // 手机号验证\r\n    handlePhoneVerify() {\r\n      uni.navigateTo({\r\n        url: \"/pages/user/phone-verify\",\r\n      });\r\n    },\r\n\r\n    // 设置支付密码\r\n    handleSetPayPassword() {\r\n      uni.showToast({\r\n        title: \"支付密码功能开发中\",\r\n        icon: \"none\",\r\n      });\r\n    },\r\n\r\n    // 微信授权\r\n    handleWechatAuth() {\r\n      uni.showToast({\r\n        title: \"微信已授权\",\r\n        icon: \"success\",\r\n      });\r\n    },\r\n\r\n    // 实名认证\r\n    handleVerifyIdentity() {\r\n      if (this.userInfo.isVerified) {\r\n        uni.showModal({\r\n          title: \"提示\",\r\n          content: \"您已完成实名认证\",\r\n          showCancel: false,\r\n        });\r\n        return;\r\n      }\r\n\r\n      uni.showToast({\r\n        title: \"实名认证功能开发中\",\r\n        icon: \"none\",\r\n      });\r\n    },\r\n\r\n    // 修改登录密码\r\n    handleChangeLoginPassword() {\r\n      uni.showToast({\r\n        title: \"密码修改功能开发中\",\r\n        icon: \"none\",\r\n      });\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style>\r\n.security-container {\r\n  min-height: 100vh;\r\n  background-color: #f7f7f7;\r\n  padding-bottom: 30rpx;\r\n}\r\n\r\n.security-header {\r\n  padding: 40rpx 30rpx;\r\n  background-color: #fff;\r\n}\r\n\r\n.header-title {\r\n  font-size: 36rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n  margin-bottom: 10rpx;\r\n}\r\n\r\n.header-desc {\r\n  font-size: 26rpx;\r\n  color: #999;\r\n}\r\n\r\n.security-list {\r\n  margin-top: 20rpx;\r\n  background-color: #fff;\r\n}\r\n\r\n.security-item {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding: 30rpx;\r\n  border-bottom: 1px solid #f5f5f5;\r\n}\r\n\r\n.security-item:last-child {\r\n  border-bottom: none;\r\n}\r\n\r\n.item-left {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.item-icon {\r\n  width: 44rpx;\r\n  height: 44rpx;\r\n  margin-right: 20rpx;\r\n}\r\n\r\n.item-info {\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.item-title {\r\n  font-size: 30rpx;\r\n  color: #333;\r\n  margin-bottom: 6rpx;\r\n}\r\n\r\n.item-value {\r\n  font-size: 24rpx;\r\n  color: #999;\r\n}\r\n\r\n.arrow-icon {\r\n  width: 32rpx;\r\n  height: 32rpx;\r\n  opacity: 0.6;\r\n}\r\n\r\n.tips-card {\r\n  margin: 30rpx;\r\n  background-color: #fff;\r\n  border-radius: 12rpx;\r\n  padding: 30rpx;\r\n  box-shadow: 0 2rpx 10rpx rgba(0, 0, 0, 0.05);\r\n}\r\n\r\n.tips-header {\r\n  display: flex;\r\n  align-items: center;\r\n  margin-bottom: 20rpx;\r\n}\r\n\r\n.tips-icon {\r\n  width: 36rpx;\r\n  height: 36rpx;\r\n  margin-right: 10rpx;\r\n}\r\n\r\n.tips-title {\r\n  font-size: 30rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n}\r\n\r\n.tips-content {\r\n  padding-left: 10rpx;\r\n}\r\n\r\n.tip-item {\r\n  display: flex;\r\n  margin-bottom: 10rpx;\r\n}\r\n\r\n.tip-dot {\r\n  margin-right: 10rpx;\r\n  color: #1296db;\r\n  font-weight: bold;\r\n}\r\n\r\n.tip-text {\r\n  font-size: 26rpx;\r\n  color: #666;\r\n  line-height: 1.6;\r\n}\r\n</style>\r\n","import MiniProgramPage from 'C:/Users/Administrator/Desktop/wx-pos/pages/user/security.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","wx"],"mappings":";;AAwIA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,UAAU;AAAA,QACR,OAAO;AAAA,QACP,YAAY;AAAA,MACb;AAAA,MACD,gBAAgB;AAAA;EAEnB;AAAA,EACD,SAAS;AACP,SAAK,iBAAgB;AAAA,EACtB;AAAA,EACD,SAAS;AACP,SAAK,YAAW;AAAA,EACjB;AAAA,EACD,SAAS;AAAA;AAAA,IAEP,mBAAmB;AACjB,YAAM,WAAWA,cAAAA,MAAI,eAAe,UAAU;AAC9C,UAAI,CAAC,UAAU;AACbA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,UACN,SAAS,MAAM;AACb,uBAAW,MAAM;AACfA,4BAAG,MAAC,aAAY;AAAA,YACjB,GAAE,IAAI;AAAA,UACR;AAAA,QACH,CAAC;AAAA,MACH;AAAA,IACD;AAAA;AAAA,IAGD,cAAc;AACZ,YAAM,cAAcA,cAAAA,MAAI,eAAe,UAAU;AACjD,UAAI,aAAa;AACf,YAAI;AACF,gBAAM,WAAW,KAAK,MAAM,WAAW;AACvC,eAAK,WAAW;AAGhB,cAAI,SAAS,KAAK;AAChB,iBAAK,sBAAsB,SAAS,GAAG;AAAA,UACzC;AAAA,QACF,SAAS,GAAG;AACVA,wBAAA,MAAA,MAAA,SAAA,kCAAc,YAAY,CAAC;AAAA,QAC7B;AAAA,MACF;AAAA,IACD;AAAA;AAAA,IAGD,sBAAsB,QAAQ;AAC5B,YAAM,KAAKC,cAAAA,KAAG,MAAM,SAAQ;AAC5B,SAAG,WAAW,UAAU,EACrB,IAAI,MAAM,EACV,IAAI,EACJ,KAAK,CAAC,QAAQ;AACb,YAAI,IAAI,MAAM;AAEZ,eAAK,WAAW,IAAI;AAGpB,eAAK,iBAAiB,CAAC,CAAC,IAAI,KAAK;AAAA,QACnC;AAAA,OACD,EACA,MAAM,CAAC,QAAQ;AACdD,sBAAA,MAAA,MAAA,SAAA,kCAAc,cAAc,GAAG;AAAA,MACjC,CAAC;AAAA,IACJ;AAAA;AAAA,IAGD,oBAAoB;AAClBA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK;AAAA,MACP,CAAC;AAAA,IACF;AAAA;AAAA,IAGD,uBAAuB;AACrBA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,MAAM;AAAA,MACR,CAAC;AAAA,IACF;AAAA;AAAA,IAGD,mBAAmB;AACjBA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,MAAM;AAAA,MACR,CAAC;AAAA,IACF;AAAA;AAAA,IAGD,uBAAuB;AACrB,UAAI,KAAK,SAAS,YAAY;AAC5BA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,SAAS;AAAA,UACT,YAAY;AAAA,QACd,CAAC;AACD;AAAA,MACF;AAEAA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,MAAM;AAAA,MACR,CAAC;AAAA,IACF;AAAA;AAAA,IAGD,4BAA4B;AAC1BA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,MAAM;AAAA,MACR,CAAC;AAAA,IACF;AAAA,EACF;AACH;;;;;;;;;;;;;;AC9PA,GAAG,WAAW,eAAe;"}