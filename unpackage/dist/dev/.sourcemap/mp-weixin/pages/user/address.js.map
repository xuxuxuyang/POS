{"version":3,"file":"address.js","sources":["pages/user/address.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdXNlci9hZGRyZXNzLnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"address-container\">\r\n    <view class=\"address-header\">\r\n      <text class=\"header-title\">收货地址管理</text>\r\n    </view>\r\n\r\n    <!-- 地址列表 -->\r\n    <view v-if=\"addressList.length > 0\" class=\"address-list\">\r\n      <view\r\n        class=\"address-item\"\r\n        v-for=\"(item, index) in addressList\"\r\n        :key=\"index\"\r\n        @click=\"selectAddress(item)\"\r\n      >\r\n        <view class=\"item-info\">\r\n          <view class=\"info-header\">\r\n            <text class=\"name\">{{ item.name }}</text>\r\n            <text class=\"phone\">{{ item.phone }}</text>\r\n            <view class=\"tag\" v-if=\"item.isDefault\">默认</view>\r\n          </view>\r\n          <view class=\"address-detail\"\r\n            >{{ item.province }}{{ item.city }}{{ item.district\r\n            }}{{ item.address }}</view\r\n          >\r\n        </view>\r\n        <view class=\"item-actions\">\r\n          <view class=\"action-edit\" @click.stop=\"editAddress(item)\">编辑</view>\r\n          <view class=\"action-delete\" @click.stop=\"deleteAddress(item)\"\r\n            >删除</view\r\n          >\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 空状态 -->\r\n    <view v-else class=\"empty-state\">\r\n      <image\r\n        src=\"https://cdn-icons-png.flaticon.com/128/4076/4076445.png\"\r\n        class=\"empty-icon\"\r\n      ></image>\r\n      <text class=\"empty-text\">暂无收货地址</text>\r\n    </view>\r\n\r\n    <!-- 添加按钮 -->\r\n    <view class=\"add-address\" @click=\"addNewAddress\">\r\n      <text class=\"add-icon\">+</text>\r\n      <text class=\"add-text\">新增收货地址</text>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      addressList: [],\r\n      userId: \"\",\r\n    };\r\n  },\r\n  onLoad() {\r\n    // 检查登录状态\r\n    this.checkLoginStatus();\r\n  },\r\n  onShow() {\r\n    // 每次显示页面时刷新地址列表\r\n    this.fetchAddressList();\r\n  },\r\n  methods: {\r\n    // 检查登录状态\r\n    checkLoginStatus() {\r\n      const userInfo = uni.getStorageSync(\"userInfo\");\r\n      if (userInfo) {\r\n        const parsedInfo = JSON.parse(userInfo);\r\n        this.userId = parsedInfo._id;\r\n        this.fetchAddressList();\r\n      } else {\r\n        uni.showToast({\r\n          title: \"请先登录\",\r\n          icon: \"none\",\r\n          success: () => {\r\n            setTimeout(() => {\r\n              uni.navigateBack();\r\n            }, 1500);\r\n          },\r\n        });\r\n      }\r\n    },\r\n\r\n    // 获取地址列表\r\n    fetchAddressList() {\r\n      uni.showLoading({\r\n        title: \"加载中...\",\r\n      });\r\n\r\n      const db = wx.cloud.database();\r\n\r\n      // 先检查集合是否存在，如果不存在则显示空列表\r\n      // 由于微信小程序云开发没有直接检查集合是否存在的API，\r\n      // 我们通过捕获错误的方式处理\r\n      db.collection(\"address\")\r\n        .where({\r\n          userId: this.userId,\r\n        })\r\n        .get()\r\n        .then((res) => {\r\n          this.addressList = res.data;\r\n          uni.hideLoading();\r\n        })\r\n        .catch((err) => {\r\n          console.error(\"获取地址列表失败\", err);\r\n          uni.hideLoading();\r\n\r\n          // 处理集合不存在的错误\r\n          if (\r\n            err.errCode === -502005 ||\r\n            (err.errMsg && err.errMsg.includes(\"collection not exists\"))\r\n          ) {\r\n            this.addressList = []; // 设置为空列表\r\n\r\n            // 可以选择自动创建集合的示例数据\r\n            this.createAddressCollection();\r\n          } else {\r\n            uni.showToast({\r\n              title: \"加载失败\",\r\n              icon: \"none\",\r\n            });\r\n          }\r\n        });\r\n    },\r\n\r\n    // 创建地址集合\r\n    createAddressCollection() {\r\n      // 在实际应用中，集合应该在云函数中创建\r\n      // 这里我们只是提示用户\r\n      uni.showModal({\r\n        title: \"提示\",\r\n        content: \"地址数据初始化中，请添加您的第一个收货地址\",\r\n        showCancel: false,\r\n        success: () => {\r\n          // 可以引导用户添加第一个地址\r\n        },\r\n      });\r\n    },\r\n\r\n    // 选择地址\r\n    selectAddress(address) {\r\n      // 获取来源页面的事件通道\r\n      const eventChannel = this.getOpenerEventChannel();\r\n\r\n      // 如果有页面需要返回地址信息，通过事件通道传递\r\n      eventChannel.emit(\"selectAddress\", address);\r\n\r\n      // 返回上一页\r\n      uni.navigateBack();\r\n    },\r\n\r\n    // 编辑地址\r\n    editAddress(address) {\r\n      uni.navigateTo({\r\n        url: \"/pages/user/address-edit?id=\" + address._id,\r\n      });\r\n    },\r\n\r\n    // 删除地址\r\n    deleteAddress(address) {\r\n      uni.showModal({\r\n        title: \"提示\",\r\n        content: \"确定要删除该地址吗？\",\r\n        success: (res) => {\r\n          if (res.confirm) {\r\n            uni.showLoading({\r\n              title: \"删除中...\",\r\n            });\r\n\r\n            const db = wx.cloud.database();\r\n            db.collection(\"address\")\r\n              .doc(address._id)\r\n              .remove()\r\n              .then(() => {\r\n                uni.hideLoading();\r\n                uni.showToast({\r\n                  title: \"删除成功\",\r\n                  icon: \"success\",\r\n                });\r\n                this.fetchAddressList();\r\n              })\r\n              .catch((err) => {\r\n                console.error(\"删除地址失败\", err);\r\n                uni.hideLoading();\r\n                uni.showToast({\r\n                  title: \"删除失败\",\r\n                  icon: \"none\",\r\n                });\r\n              });\r\n          }\r\n        },\r\n      });\r\n    },\r\n\r\n    // 新增地址\r\n    addNewAddress() {\r\n      uni.navigateTo({\r\n        url: \"/pages/user/address-edit\",\r\n      });\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style>\r\n.address-container {\r\n  padding: 20rpx 0;\r\n  min-height: 100vh;\r\n  background-color: #f7f7f7;\r\n}\r\n\r\n.address-header {\r\n  padding: 30rpx;\r\n  background-color: #fff;\r\n}\r\n\r\n.header-title {\r\n  font-size: 34rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n}\r\n\r\n.address-list {\r\n  margin-top: 20rpx;\r\n}\r\n\r\n.address-item {\r\n  display: flex;\r\n  background-color: #fff;\r\n  padding: 30rpx;\r\n  margin-bottom: 20rpx;\r\n  border-radius: 12rpx;\r\n  box-shadow: 0 2rpx 10rpx rgba(0, 0, 0, 0.05);\r\n}\r\n\r\n.item-info {\r\n  flex: 1;\r\n}\r\n\r\n.info-header {\r\n  display: flex;\r\n  align-items: center;\r\n  margin-bottom: 10rpx;\r\n}\r\n\r\n.name {\r\n  font-size: 32rpx;\r\n  font-weight: bold;\r\n  margin-right: 20rpx;\r\n}\r\n\r\n.phone {\r\n  font-size: 28rpx;\r\n  color: #666;\r\n  margin-right: 20rpx;\r\n}\r\n\r\n.tag {\r\n  font-size: 22rpx;\r\n  color: #fff;\r\n  background-color: #1296db;\r\n  padding: 4rpx 12rpx;\r\n  border-radius: 6rpx;\r\n}\r\n\r\n.address-detail {\r\n  font-size: 28rpx;\r\n  color: #666;\r\n  line-height: 1.4;\r\n}\r\n\r\n.item-actions {\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: space-between;\r\n  align-items: flex-end;\r\n  padding-left: 20rpx;\r\n}\r\n\r\n.action-edit,\r\n.action-delete {\r\n  font-size: 24rpx;\r\n  padding: 6rpx 0;\r\n  color: #666;\r\n}\r\n\r\n.empty-state {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n  padding: 100rpx 0;\r\n}\r\n\r\n.empty-icon {\r\n  width: 160rpx;\r\n  height: 160rpx;\r\n  margin-bottom: 30rpx;\r\n  opacity: 0.5;\r\n}\r\n\r\n.empty-text {\r\n  font-size: 30rpx;\r\n  color: #999;\r\n}\r\n\r\n.add-address {\r\n  position: fixed;\r\n  bottom: 40rpx;\r\n  left: 30rpx;\r\n  right: 30rpx;\r\n  height: 90rpx;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  background-color: #1296db;\r\n  border-radius: 45rpx;\r\n  color: #fff;\r\n  font-size: 32rpx;\r\n  box-shadow: 0 4rpx 20rpx rgba(18, 150, 219, 0.3);\r\n}\r\n\r\n.add-icon {\r\n  font-size: 40rpx;\r\n  margin-right: 10rpx;\r\n  margin-top: -5rpx;\r\n}\r\n</style>\r\n","import MiniProgramPage from 'C:/Users/Administrator/Desktop/wx-pos/pages/user/address.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","wx"],"mappings":"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"}